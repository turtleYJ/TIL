# 영속성 컨텍스트
- "엔티티를 영구 저장하는 환경"
- EntitiyManager.persist(entity);
- 이 코드가 단순히 DB에 엔티티를 만드는 것보다 더 깊은 내용을 함축한다.(엔티티를 영속성 컨텍스트에 저장한다.)
- 영속성 컨텍스트는 논리적 개념이다.(눈에 보이지 않음)
- 엔티티 매니저를 통해서 영속성 컨텍스트에 접근한다.

![](Images/1.png)

## 엔티티의 생명주기
1. 비영속(new/transient)
- 영속성 컨텍스트와 전혀 관계가 없는 새로운 상태

```java
Member meber = new Member();
member.setId("member1");
member.setUsername("회원1");
```

2. 영속(managed)
- 영속성 컨텍스트에 관리되는 상태

3. 준영속(detached)
- 영속성 컨텍스트에 저장되었다가 분리된 상태

4. 삭제(removed)
- 삭제된 상태

# 플러시
- 영속성 컨텍스트의 변경 내용을 데이터베이스에 반영
- em.flush()를 하게되면 변경 '쓰기 지연 SQL저장소'에 있던 SQL문들이 커밋된다.
- 이때 1차 캐시들을 그대로 유지된다.

## 영속성 컨텍스트를 플러시하는 방법
- em.flush() - 직접호출
- 트랜잭션 커밋 - 플러시 자동 호출
- JPQL 쿼리 실행 - 플러시 자동 호출

## 플러시 정리
- 영속성 컨텍스트를 비우지 않는다.
- 영속성 컨텍스트의 변경내용을 데이터베이스에 동기화시킨다.
- 트랜잭션이라는 작업 단위가 중요 -> 커밋 직전에만 동기화하면 됨
- 단, JPQL 쿼리 실행은 예외적으로 플러시를 자동으로 호출하고 코드가 실행된다.

